<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Store Management</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div class="grid grid-cols-12 h-screen bg-gradient-to-r from-green-900 to-blue-900">

        <!-- Left Navigation Bar -->
        <div class="rounded-r-2xl py-10 bg-white flex items-center">
            <div>
                <div class="w-full bg-white text-center border-t-2 border-b-2 border-black py-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    Category
                </div>
                <button class="w-full bg-gray text-center mt-5" onclick="changeCard('category-add')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                    </svg>
                    Add
                </button>
                <button class="w-full bg-gray text-center mt-5" onclick="changeCard('category-delete')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    Delete
                </button>
                <button class="w-full bg-gray text-center mt-5" onclick="changeCard('category-find')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    Find
                </button>
                <div class="w-full bg-white text-center border-t-2 border-b-2 border-black py-3 mt-10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    Product
                </div>
                <button class="w-full bg-gray text-center mt-5" onclick="changeCard('product-add')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                    </svg>
                    Add
                </button>
                <button class="w-full bg-gray text-center mt-5" onclick="changeCard('product-update')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Update</button>
                <button class="w-full bg-gray text-center mt-5" onclick="changeCard('product-delete')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    Delete
                </button>
                <button class="w-full bg-gray text-center mt-5" onclick="changeCard('product-find')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    Find
                </button>
            </div>
        </div>

        <!-- Card Container -->
        <div class="col-span-11 flex items-center">

            <!-- Add Category Card -->
            <div class="card h-2/5 w-1/3 mx-auto rounded-lg bg-gray-200 hidden" id="category-add">
                <div class="h-1/6 border-b-2 flex items-center px-5 text-xl font-medium">
                    Add Category
                </div>
                <div class="h-4/6 px-5 py-2 bg-white">
                    <div class="mt-3">
                        <label class="font-medium">Category Name</label>
                        <input type="text" id="add-category-name" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                    </div>
                    <div class="mt-3">
                        <label class="font-medium">Parent Category Name</label>
                        <select type="text" id="add-parent-name" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                            <option>None</option>
                        </select>
                    </div>
                </div>
                <div class="h-1/6 border-t-2 flex items-center justify-end px-10">
                    <button class="button rounded-md bg-gray-500 text-white px-5 py-1" onclick="addCategory()">Add</button>
                </div>
            </div>

            <!-- Delete Category Card -->
            <div class="card h-2/6 w-1/3 mx-auto rounded-lg bg-gray-200 hidden" id="category-delete">
                <div class="h-1/5 border-b-2 flex items-center px-5 text-xl font-medium">
                    Delete Category
                </div>
                <div class="h-3/5 px-5 py-2 bg-white flex items-center">
                    <div class="w-full">
                        <label class="font-medium">Category Name</label>
                        <select type="text" id="delete-category-name" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                        </select>
                    </div>
                </div>
                <div class="h-1/5 border-t-2 flex items-center justify-end px-10">
                    <button class="button rounded-md bg-red-500 text-white px-5 py-1" onclick="deleteCategory()">Delete</button>
                </div>
            </div>

            <!-- Find Category Card -->
            <div class="card h-4/5 w-3/4 mx-auto rounded-lg bg-gray-200 hidden" id="category-find">
                <div class="h-2/6 border-b-2 p-5 font-medium">
                    <div class="text-xl">Find Category</div>
                    <hr class="border-black my-5">
                    <div class="grid grid-cols-2 gap-x-4">
                        <div>
                            <label class="font-medium w-full">Search By Category</label>
                            <div class="w-full mt-4 pr-5 grid grid-cols-8 gap-x-4">
                                <input type="text" id="find-category-name" placeholder="Product Name" autocomplete="off" class="col-span-6 bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3">
                                <button class="col-span-2 rounded-md bg-gray-500 text-white px-5 py-1" onclick="findCategory('specific')">Search</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="h-4/6 px-5 py-2 bg-white">
                    <div class="h-full w-full p-5">
                        <div class="w-3/4 mx-auto rounded-lg">
                            <table class="w-full border-2">
                                <thead class="bg-gray-100 dark:bg-gray-700 border-b-2">
                                    <tr class="bg-gray-100 dark:bg-gray-700">
                                        <th class="py-2">ID</th>
                                        <th class="py-2">Categories</th>
                                        <th class="py-2">Child Categories</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y-2" id="category-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Product Card -->
            <div class="card h-4/6 w-1/3 mx-auto rounded-lg bg-gray-200 hidden" id="product-add">
                <div class="h-1/6 border-b-2 flex items-center px-5 text-xl font-medium">
                    Add Product
                </div>
                <div class="h-4/6 px-5 py-2 bg-white">
                    <div class="mt-4">
                        <label class="font-medium">Product Name</label>
                        <input type="text" id="add-product-name" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                    </div>
                    <div class="mt-4">
                        <label class="font-medium">Product Category</label>
                        <select type="text" id="add-product-category" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4" multiple>
                        </select>
                    </div>
                    <div class="mt-4">
                        <label class="font-medium">Product Price</label>
                        <input type="number" id="add-product-price" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                    </div>
                </div>
                <div class="h-1/6 border-t-2 flex items-center justify-end px-10">
                    <button class="button rounded-md bg-gray-500 text-white px-5 py-1" onclick="addProduct()">Add</button>
                </div>
            </div>

            <!-- Update Product Card -->
            <div class="card h-3/5 w-1/3 mx-auto rounded-lg bg-gray-200 hidden" id="product-update">
                <div class="h-1/6 border-b-2 flex items-center px-5 text-xl font-medium">
                    Update Product
                </div>
                <div class="h-4/6 px-5 py-2 bg-white">
                    <div class="mt-4">
                        <label class="font-medium">Product Name</label>
                        <select type="text" id="update-product-name" autocomplete="off" onchange="updateProductData()"
                                class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                        </select>
                    </div>
                    <div class="mt-4">
                        <label class="font-medium">New Name</label>
                        <input type="text" id="update-new-name" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                    </div>
                    <div class="mt-4">
                        <label class="font-medium">Product Price</label>
                        <input type="number" id="update-product-price" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                    </div>
                </div>
                <div class="h-1/6 border-t-2 flex items-center justify-end px-10">
                    <button class="button rounded-md bg-gray-500 text-white px-5 py-1" onclick="updateProduct()">Update</button>
                </div>
            </div>

            <!-- Delete Product Card -->
            <div class="card h-2/6 w-1/3 mx-auto rounded-lg bg-gray-200 hidden" id="product-delete">
                <div class="h-1/5 border-b-2 flex items-center px-5 text-xl font-medium">
                    Delete Product
                </div>
                <div class="h-3/5 px-5 py-2 bg-white flex items-center">
                    <div class="w-full">
                        <label class="font-medium">Product Name</label>
                        <select type="text" id="delete-product-name" autocomplete="off" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3 mt-4">
                        </select>
                    </div>
                </div>
                <div class="h-1/5 border-t-2 flex items-center justify-end px-10">
                    <button class="button rounded-md bg-red-500 text-white px-5 py-1" onclick="deleteProduct()">Delete</button>
                </div>
            </div>

            <!-- Find Product Card -->
            <div class="card h-4/5 w-3/4 mx-auto rounded-lg bg-gray-200 hidden" id="product-find">
                <div class="h-2/6 border-b-2 p-5 font-medium">
                    <div class="text-xl">Find Product</div>
                    <hr class="border-black my-5">
                    <div class="grid grid-cols-2 gap-x-4">
                        <div>
                            <label class="font-medium w-full">Search By Product Name</label>
                            <div class="w-full mt-4 pr-5 grid grid-cols-8 gap-x-4">
                                <input type="text" id="find-product-name" placeholder="Product Name" autocomplete="off" class="col-span-6 bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3">
                                <button class="col-span-2 rounded-md bg-gray-500 text-white px-5 py-1" onclick="findProduct('name')">Search</button>
                            </div>
                        </div>
                        <div>
                            <label class="font-medium w-full">Search By Category</label>
                            <div class="w-full mt-4 pr-5 grid grid-cols-8 gap-x-4">
                                <input type="text" id="find-product-category" placeholder="Category" autocomplete="off" class="col-span-6 bg-gray-100 bg-opacity-50 rounded border border-gray-300 text-base outline-none text-gray-700 py-1 px-3">
                                <button class="col-span-2 rounded-md bg-gray-500 text-white px-5 py-1" onclick="findProduct('category')">Search</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="h-4/6 px-5 py-2 bg-white">
                    <div class="h-full w-full p-5">
                        <div class="w-3/4 mx-auto rounded-lg">
                            <table class="w-full border-2">
                                <thead class="bg-gray-100 dark:bg-gray-700 border-b-2">
                                    <tr class="bg-gray-100 dark:bg-gray-700">
                                        <th class="py-2">Product Name</th>
                                        <th class="py-2">Categories</th>
                                        <th class="py-2">Price</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y-2" id="product-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

        // Categories and Product List
        products = {}
        categories = {}

        // Function to change cards
        var prevCard = ""
        function changeCard(card) {
            if (prevCard != "") {
                document.getElementById(prevCard).classList.add("hidden")
            }
            document.getElementById(card).classList.remove("hidden")
            prevCard = card

            if (card == 'product-find') {
                findProduct('all')
            } else if (card == 'category-find') {
                findCategory('all')
            }
        }
        changeCard('category-add')

        function addCategory() {
            name = document.getElementById('add-category-name').value
            parent = document.getElementById('add-parent-name').value
            if (name != "") {
                $.ajax
                ({
                    type: "POST",
                    url: "http://127.0.0.1:8000/api/addCategory/",
                    data: JSON.stringify({'category_name': name,
                            'parent_category': parent}),
                    success: function(res)
                    {
                        document.getElementById('add-category-name').value = ""
                        alert('Category added successfully!')
                        getCategories()
                    },
                    error: function(res) {
                        document.getElementById('add-category-name').value = ""
                        alert('Duplicate category name!')
                    }
                })
            } else {
                alert("Please fill all the details!")
            }
        }

        function deleteCategory() {
            id = document.getElementById('delete-category-name').value
            if (name != "") {
                $.ajax
                ({
                    type: "DELETE",
                    url: "http://127.0.0.1:8000/api/category/" + id + '/',
                    success: function(res)
                    {
                        alert('Category deleted successfully!')
                        getCategories()
                    }
                })
            } else {
                alert("Please fill all the details!")
            }
        }

        function addProduct() {
            name = document.getElementById('add-product-name').value
            category = document.getElementById('add-product-category')
            category = [...category.selectedOptions]
                    .map(option => option.value).toString()
            price = document.getElementById('add-product-price').value
            if (name != "" && category != "" && price != "") {
                $.ajax
                ({
                    type: "POST",
                    url: "http://127.0.0.1:8000/api/addProduct/",
                    data: JSON.stringify({'product_name': name,
                            'categories': category,
                            'price': price}),
                    success: function(res)
                    {
                        document.getElementById('add-product-name').value = ""
                        document.getElementById('add-product-price').value = ""
                        alert('Product added successfully!')
                        getProducts()
                    },
                    error: function(res)
                    {
                        document.getElementById('add-product-name').value = ""
                        alert('Duplicate Product Name!')
                    }
                })
            } else {
                alert("Please fill all the details!")
            }
        }

        function updateProduct() {
            id = document.getElementById('update-product-name').value
            new_name = document.getElementById('update-new-name').value
            price = document.getElementById('update-product-price').value
            if (new_name != "" && price != "") {
                $.ajax
                ({
                    type: "PUT",
                    url: "http://127.0.0.1:8000/api/product/" + id + '/',
                    data: JSON.stringify({'product_name': new_name,
                            'categories': products[id][1],
                            'price': price}),
                    success: function(res)
                    {
                        alert('Product updated successfully')
                        getProducts()
                    },
                    error: function(res)
                    {
                        alert('Duplicate Product Name!')
                    }
                })
            } else {
                alert("Please fill all the details!")
            }
        }

        function deleteProduct() {
            id = document.getElementById('delete-product-name').value
            if (name != "") {
                $.ajax
                ({
                    type: "DELETE",
                    url: "http://127.0.0.1:8000/api/product/" + id + '/',
                    success: function(res)
                    {
                        alert('Product deleted successfully!')
                        getProducts()
                    }
                })
            } else {
                alert("Please fill all the details!")
            }
        }

        function getCategories() {
            $.ajax
            ({
                type: "GET",
                url: "http://127.0.0.1:8000/api/categoryList/",
                success: function(res)
                {
                    add_parent = document.getElementById('add-parent-name')
                    add_parent.innerHTML = "<option>None</option>"

                    delete_category = document.getElementById('delete-category-name')
                    product_category = document.getElementById('add-product-category')
                    product_category.innerHTML = delete_category.innerHTML = ""
                    categories = {}
                    for (i = 0; i < res.length; i++) {
                        categories[res[i].category_name] = res[i].parent_category
                        delete_category.innerHTML += "<option value=\"" + res[i].id + "\">" + res[i].category_name + "</option>"
                        product_category.innerHTML += "<option>" + res[i].category_name + "</option>"
                        add_parent.innerHTML += "<option>" + res[i].category_name + "</option>"
                    }
                }
            })
        }
        getCategories()

        function getProducts(sel) {
            $.ajax
            ({
                type: "GET",
                url: "http://127.0.0.1:8000/api/productList/",
                success: function(res)
                {
                    products = {}
                    update_product_name = document.getElementById('update-product-name')
                    delete_product_name = document.getElementById('delete-product-name')
                    update_product_name.innerHTML = delete_product_name.innerHTML = ""
                    for (i = 0; i < res.length; i++) {
                        products[res[i].id] = [res[i].product_name, res[i].categories, res[i].price]
                        update_product_name.innerHTML += "<option value=\"" + res[i].id + "\">" + res[i].product_name + "</option>"
                        delete_product_name.innerHTML += "<option value=\"" + res[i].id + "\">" + res[i].product_name + "</option>"
                    }
                    updateProductData()
                }
            })
        }
        getProducts()

        function findCategory(sel) {
            data = {}
            if (sel == 'specific') {
                category = document.getElementById('find-category-name').value
                if (category != "") {
                    data['category'] = category
                }
            }
            $.ajax
            ({
                type: "GET",
                url: "http://127.0.0.1:8000/api/categoryList/",
                data: data,
                success: function(res)
                {
                    product_table = document.getElementById('category-table')
                    product_table.innerHTML = ""
                    for (i = 0; i < res.length; i++) {
                        product_table.innerHTML += `<tr class="divide-x-2">
                                                        <td class="py-2 px-4 text-center">` + res[i].id + `</td>
                                                        <td class="py-2 px-4">` + res[i].category_name + `</td>
                                                        <td class="py-2 px-4">` + res[i].sub_categories + `</td>
                                                    </tr>`
                    }
                }
            })
        }

        function findProduct(sel) {
            data = {}
            if (sel == 'name') {
                name = document.getElementById('find-product-name').value
                if (name != "") {
                    data['product_name'] = name
                }
            } else if (sel == 'category') {
                category = document.getElementById('find-product-category').value
                if (category != "") {
                    data['category'] = category
                }
            }
            $.ajax
            ({
                type: "GET",
                url: "http://127.0.0.1:8000/api/productList/",
                data: data,
                success: function(res)
                {
                    product_table = document.getElementById('product-table')
                    product_table.innerHTML = ""
                    for (i = 0; i < res.length; i++) {
                        product_table.innerHTML += `<tr class="divide-x-2">
                                                        <td class="py-2 px-4">` + res[i].product_name + `</td>
                                                        <td class="py-2 px-4">` + res[i].categories + `</td>
                                                        <td class="py-2 px-4">` + res[i].price + `</td>
                                                    </tr>`
                    }
                }
            })
        }
        findProduct()

        function updateProductData() {
            update_product_name = products[document.getElementById('update-product-name').value]
            if (update_product_name != "") {
                update_new_name = document.getElementById('update-new-name')
                update_product_price = document.getElementById('update-product-price')
                if (update_product_name != "") {
                    update_new_name.value = update_product_name[0]
                    update_product_price.value = update_product_name[2]
                }
            }
        }

    </script>
</body>
</html>